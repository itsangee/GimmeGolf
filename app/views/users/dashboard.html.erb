<div class="main-dashboard-container">

  <div class="d-flex justify-content-center align-items-center bg-white box-shadow">
    <div class="pt-3 pb-3 ms-5">
      <h1 class="text-center me-3">User Dashboard</h1>
      <p class="text-center mt-3"><small><%= @user.email %></small></p>
    </div>


    <div class="ms-5">
      <div class="modal-stuff pt-5 pb-5 ">
      <!-- Button trigger modal -->
      <button type="button" class="dashboard-modal-button" data-bs-toggle="modal" data-bs-target="#followersModal">
        Followers: <%= @user.followers.count %>
      </button>

      <!-- Modal -->
      <div class="modal fade" id="followersModal" tabindex="-1" aria-labelledby="followersModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content dashboard-popup-heading">
            <div class="modal-header">
              <h1 class="modal-title fs-5 text-white" id="followersModalLabel">Followers</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <% if @user.followers.any? %>
              <% @user.followers.each do |follower| %>
                  <div class="d-flex justify-content-between" >
                    <li class="list-group-item">
                      <%= link_to follower.email, user_path(follower), class: "dashboard-popup-link"  %>
                    </li>
                    <div>
                      <%= link_to "Unfollow", unfollow_user_path(follower), data: {turbo_method: :post, remote: true}, class: "dashboard-unfollow"  %>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <p class="text-light">No followers currently</p>
              <% end %>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <%# <button type="button" class="btn btn-primary">Save changes</button> %>
            </div>
          </div>
        </div>
      </div>



    <button type="button" class="dashboard-modal-button" data-bs-toggle="modal" data-bs-target="#followingModal">
      Following: <%= @user.following.count %>
    </button>

    <div class="modal fade" id="followingModal" tabindex="-1" aria-labelledby="followingModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content dashboard-popup-heading">
          <div class="modal-header">
            <h1 class="modal-title fs-5 text-white" id="followingModalLabel">Following</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <% if @user.following.any? %>
              <% @user.following.each do |followee| %>
                  <div class="d-flex justify-content-between">
                    <li class="list-group-item">
                      <%= link_to followee.email, user_path(followee), class: "dashboard-popup-link" %>
                    </li>
                    <div>
                      <%= link_to "Unfollow", unfollow_user_path(followee), data: {turbo_method: :post, remote: true}, class: "dashboard-unfollow"  %>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <p class="text-light">Not following anyone</p>
              <% end %>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <%# <button type="button" class="btn btn-primary">Save changes</button> %>
          </div>
        </div>
      </div>
    </div>
    </div>
    </div>
  </div>


<div class="dashboard-nav-tabs">
  <ul class="nav justify-content-center">
    <li class="nav-item">
      <a class="nav-link active" aria-current="page" href="#">Active</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Link</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Link</a>
    </li>
    <li class="nav-item">
      <a class="nav-link disabled">Disabled</a>
    </li>
  </ul>
</div>

  <div class="box-shadow bg-white">

    <div class="dashboard-info-panel">

      <div class="dashboard-invitations-container">
        <% if current_user.count_invites > 0 %>
          <p><b><%= current_user.count_invites %></b> outstanding invitations</p>
        <% end %>
        <% if @invitations.any? %>
          <% @invitations.each do |invitation| %>
            <div class="dashboard-invitations">
              <div class="ps-3 pt-3">
                <p><b><%= link_to invitation.booking.slot.course.name, course_path(invitation.booking.slot.course) %></b> - <%= "#{invitation.booking.slot.start_time.strftime("%I:%M %p")}, #{invitation.booking.date.strftime("%d/%m/%Y")}" %></p>
                <p><small class="text-muted">Invited by: <%= link_to invitation.booking.user.first_name, user_path(invitation.booking.user) %> on <%= invitation.created_at.strftime("%A, %d %b %Y") %></small></p>
              </div>
              <div class="dashboard-invitation-actions d-flex align-items-center justify-content-center">
                <div>
                  <%= form_with url: accept_booking_path(invitation.booking), method: :post do |form| %>
                    <%= form.submit "Accept", class: "dashboard-accept-button" %>
                  <% end %>
                </div>
                <div>
                  <%= link_to invitation_path(invitation), data: {turbo_method: :delete, turbo_confirm: "Ignore this invite?"} do %>
                    <i class="ms-3 fa-regular fa-x"></i>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <p>No invites currently... go to our main page to find a game near you!</p>
        <% end %>
      </div>

  <div class="dashboard-info-panel-photo">
    <div style="
      position: absolute;
      color: white;
      font-size: 3rem;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
  ">Latest Invitations</div>
  </div>

  </div>
  </div>
<div>
  <div data-controller="show-bookings" class="dashboard-show-bookings">

    <div class="bookings-container">
      <div style="display: flex;
    align-items: stretch;">
        <ul class="nav d-flex align-items-center justify-content-center">
          <li class="nav-item">
            <a class="nav-link active dashboard-cursor " aria-current="page" id="today"
            data-action="click->show-bookings#showContent">| Today's Bookings |</a>
          </li>
          <li class="nav-item">
            <a class="nav-link dashboard-cursor " id="past"
            data-action="click->show-bookings#showContent">| Past Bookings |</a>
          </li>
          <li class="nav-item">
            <a class="nav-link dashboard-cursor " id="future"
            data-action="click->show-bookings#showContent">| Future Bookings |</a>
          </li>
        </ul>
      </div>



        <div class="dashboard-bookings">

          <div>
            <div class="d-none future" data-show-bookings-target="bookings">
              <% if @future_bookings.any? %>
                <% @future_bookings.each do |booking| %>
                  <ul>
                    <%# <hr> %>
                    <li>
                      <div class=" ps-2 d-flex align-items-center">
                        <%= cl_image_tag booking.slot.course.photos[0].key, height: 100, width: 100,  crop: :fill %>
                        <div class="d-flex flex-column">
                          <p><%= link_to booking.slot.course.name, course_path(booking.slot.course)%></p>
                          <p><%= "#{booking.date.strftime("%d/%m/%Y")}, #{booking.slot.start_time.strftime("%I:%M %p")}" %></p>
                        </div>
                      </div>
                      <div>
                        <%= link_to booking_path(booking), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to cancel the booking?"} do %>
                          <div class="d-flex align-items-center dashboard-booking-delete pe-3">
                            <i class="fa-regular fa-x ms-2 mb-2"></i>
                          </div>
                        <% end %>
                      </div>
                    </li>
                    <%# <hr> %>
                  </ul>
                <% end %>
              <% else %>
                <p class="mt-3 ms-3 text-center pt-3 pb-3 dashboard-empty-booking">No bookings</p>
              <% end %>
            </div>
          </div>


          <div>
            <div class="d-none past" data-show-bookings-target="bookings">
              <% if @past_bookings.any? %>

                <% @past_bookings.each do |booking| %>
                  <ul>
                    <%# <hr> %>
                    <li>
                      <div class=" ps-2 d-flex align-items-center">
                        <%= cl_image_tag booking.slot.course.photos[0].key, height: 100, width: 100,  crop: :fill %>
                        <div class="d-flex flex-column">
                          <p><%= link_to booking.slot.course.name, course_path(booking.slot.course)%></p>
                          <p><%= "#{booking.date.strftime("%d/%m/%Y")}, #{booking.slot.start_time.strftime("%I:%M %p")}" %></p>
                        </div>
                      </div>
                    </li>
                    <%# <hr> %>
                  </ul>
                <% end %>
              <% else %>
                <p class="mt-3 ms-3 pt-3 pb-3 text-center dashboard-empty-booking">No bookings yet.. head on over and check out our courses</p>
              <% end %>
            </div>
          </div>


          <div>
            <div class="today" data-show-bookings-target="bookings">
              <% if @todays_bookings.any? %>
                <% @todays_bookings.each do |booking| %>
                  <ul>
                    <%# <hr> %>
                    <li>
                      <div class=" ps-2 d-flex align-items-center">
                        <%= cl_image_tag booking.slot.course.photos[0].key, height: 100, width: 100,  crop: :fill %>
                        <div class="d-flex flex-column">
                          <p><%= link_to booking.slot.course.name, course_path(booking.slot.course)%></p>
                          <p><%= "#{booking.date.strftime("%d/%m/%Y")}, #{booking.slot.start_time.strftime("%I:%M %p")}" %></p>
                      </div>
                      </div>
                      <div>
                        <%= link_to booking_path(booking), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to cancel the booking?"} do %>
                          <div class="d-flex align-items-center dashboard-booking-delete pe-3">
                            <i class="fa-regular fa-x ms-2 mb-2"></i>
                          </div>
                        <% end %>
                      </div>
                    </li>
                    <%# <hr> %>
                  </ul>
                <% end %>
              <% else %>
                <p class="mt-3 ms-3 text-center pt-3 pb-3 dashboard-empty-booking">No bookings</p>
              <% end %>
            </div>
          </div>
        </div>
    </div>

<div class="dashboard-booking-panel-photo">
    <div style="
      position: absolute;
      color: white;
      font-size: 3rem;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
  ">Your Bookings</div>
  </div>
      </div>

    </div>
</div>
