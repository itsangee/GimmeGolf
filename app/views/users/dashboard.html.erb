<div class="main-dashboard-container">

  <div class="d-flex justify-content-center align-items-center bg-white box-shadow">
    <div class="pt-3 pb-3 ms-5">
      <h1 class="text-center me-3">User Dashboard</h1>
      <p class="text-center mt-3"><small><%= @user.email %></small></p>
    </div>

    <div class="ms-5">
      <div class="modal-stuff pt-5 pb-5 ">
      <!-- Button trigger modal -->
      <button type="button" class="dashboard-modal-button" data-bs-toggle="modal" data-bs-target="#followersModal">
        Followers: <%= @user.followers.count %>
      </button>

      <!-- Modal -->
      <div class="modal fade" id="followersModal" tabindex="-1" aria-labelledby="followersModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content dashboard-popup-heading">
            <div class="modal-header">
              <h1 class="modal-title fs-5 text-white" id="followersModalLabel">Followers</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <% if @user.followers.any? %>
              <% @user.followers.each do |follower| %>
                  <div class="d-flex justify-content-between" >
                    <li class="list-group-item">
                      <%= link_to follower.email, user_path(follower), class: "dashboard-popup-link"  %>
                    </li>
                    <div>
                      <%= link_to "Unfollow", unfollow_user_path(follower), data: {turbo_method: :post, remote: true}, class: "dashboard-unfollow"  %>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <p class="text-light">No followers currently</p>
              <% end %>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <%# <button type="button" class="btn btn-primary">Save changes</button> %>
            </div>
          </div>
        </div>
      </div>



    <button type="button" class="dashboard-modal-button" data-bs-toggle="modal" data-bs-target="#followingModal">
      Following: <%= @user.following.count %>
    </button>

    <div class="modal fade" id="followingModal" tabindex="-1" aria-labelledby="followingModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content dashboard-popup-heading">
          <div class="modal-header">
            <h1 class="modal-title fs-5 text-white" id="followingModalLabel">Following</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <% if @user.following.any? %>
              <% @user.following.each do |followee| %>
                  <div class="d-flex justify-content-between">
                    <li class="list-group-item">
                      <%= link_to followee.email, user_path(followee), class: "dashboard-popup-link" %>
                    </li>
                    <div>
                      <%= link_to "Unfollow", unfollow_user_path(followee), data: {turbo_method: :post, remote: true}, class: "dashboard-unfollow"  %>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <p class="text-light">Not following anyone</p>
              <% end %>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <%# <button type="button" class="btn btn-primary">Save changes</button> %>
          </div>
        </div>
      </div>
    </div>
    </div>
    </div>
  </div>

  <div class="box-shadow bg-white">
    <div class="dashboard-invitations-container">
      <h3 class="mb-3">Your invitations:</h3>
      <% if current_user.count_invites > 0 %>
        <p><%= current_user.count_invites %> outstanding invitations</p>
      <% end %>
      <% if @invitations.any? %>
        <% @invitations.each do |invitation| %>
          <div class="dashboard-invitations">
            <div class="ps-3 pt-3">
              <p><%= link_to invitation.booking.slot.course.name, course_path(invitation.booking.slot.course) %> - <%= "#{invitation.booking.slot.start_time.strftime("%I:%M %p")}, #{invitation.booking.date.strftime("%d/%m/%Y")}" %></p>
              <p><small class="text-muted">Invited by: <%= link_to invitation.booking.user.email, user_path(invitation.booking.user) %></small></p>
            </div>
            <div class="pe-3 d-flex flex-column align-items-center justify-content-center">
              <div>
                <%= form_with url: accept_booking_path(invitation.booking), method: :post do |form| %>
                  <%= form.submit "Accept", class: "dashboard-accept-button" %>
                <% end %>
              </div>
              <div>
                <%= link_to "Ignore", invitation_path(invitation), class: "text-muted", style: "font-size: 0.9rem", data: {turbo_method: :delete, turbo_confirm: "Ignore this invite?"} %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <p>No invites currently</p>
      <% end %>
    </div>
  </div>

  <div class='box-shadow'>

  <%# Start of bookings panel %>
    <div data-controller="show-bookings" class="d-flex flex-column align-items-center justify-content-center dashboard-show-bookings">
      <div>
        <ul class="nav justify-content-center">
          <li class="nav-item">
            <a class="nav-link active dashboard-cursor " aria-current="page" id="today"
            data-action="click->show-bookings#showContent">| Today's Bookings |</a>
          </li>
          <li class="nav-item">
            <a class="nav-link dashboard-cursor " id="past"
            data-action="click->show-bookings#showContent">| Past Bookings |</a>
          </li>
          <li class="nav-item">
            <a class="nav-link dashboard-cursor " id="future"
            data-action="click->show-bookings#showContent">| Future Bookings |</a>
          </li>
        </ul>
      </div>

      <div class="dashboard-bookings">

        <div>
          <div class="d-none future" data-show-bookings-target="bookings">
            <% if @future_bookings.any? %>
              <% @future_bookings.each do |booking| %>
                <ul>
                  <hr>
                  <li>
                    <p class="mt-3 pt-3 pb-3 text-center"><%= link_to booking.slot.course.name, course_path(booking.slot.course)%>, <%= "#{booking.date.strftime("%d/%m/%Y")}, #{booking.slot.start_time.strftime("%I:%M %p")}" %>
                    <%= link_to "| Cancel booking |", booking_path(booking), class: "ms-5 pd-5 text-end dashboard-booking-delete", data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to cancel the booking?"} %>
                      <%# <% <i class="fa-solid fa-square-minus"></i> %>
                    </p>
                  </li>
                  <hr>
                </ul>
              <% end %>
            <% else %>
              <p class="mt-3 ms-3 text-center pt-3 pb-3">No bookings</p>
            <% end %>
          </div>
        </div>


        <div>
          <div class="d-none past" data-show-bookings-target="bookings">
            <% if @past_bookings.any? %>
              <% @past_bookings.each do |booking| %>
                <ul>
                  <hr>
                  <li><p class="mt-3 text-center pt-3 pb-3"><%= link_to booking.slot.course.name, course_path(booking.slot.course)%>, <%= "#{booking.date.strftime("%d/%m/%Y")}, #{booking.slot.start_time.strftime("%I:%M %p")}" %></p></li>
                  <hr>
                </ul>
              <% end %>
            <% else %>
              <p class="mt-3 ms-3 pt-3 pb-3 text-center">No bookings</p>
            <% end %>
          </div>
        </div>


        <div>
          <div class="today" data-show-bookings-target="bookings">
            <% if @todays_bookings.any? %>
              <% @todays_bookings.each do |booking| %>
                <ul>
                  <hr>
                  <li><p class="mt-3 text-center pt-3 pb-3"><%= link_to booking.slot.course.name, course_path(booking.slot.course)%>, <%= "#{booking.date.strftime("%d/%m/%Y")}, #{booking.slot.start_time.strftime("%I:%M %p")}" %></p></li>
                  <hr>
                </ul>
              <% end %>
            <% else %>
              <p class="mt-3 ms-3 text-center pt-3 pb-3">No bookings</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
<%# end of bookings panel %>
</div>

<%# Make a custom route %>
<%# duplicate the existing booking and change the user %>
<%# 'member' to get the booking id %>
